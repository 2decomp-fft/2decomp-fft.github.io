
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>API for Three-dimensional FFTs &#8212; 2decomp_doc  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Halo-cell Support" href="api_halo.html" />
    <link rel="prev" title="2D Pencil Decomposition API" href="api_domain.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="api-for-three-dimensional-ffts">
<h1>API for Three-dimensional FFTs<a class="headerlink" href="#api-for-three-dimensional-ffts" title="Permalink to this headline">¶</a></h1>
<p>To use the FFT programming interface, first of all, one additional Fortran module has to be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">decomp_2d_fft</span>
</pre></div>
</div>
<div class="section" id="initialisation-of-the-fft-module">
<h2>Initialisation of the FFT module<a class="headerlink" href="#initialisation-of-the-fft-module" title="Permalink to this headline">¶</a></h2>
<p>The FFT interface is built on top of the 2D decomposition library, which, naturally,
needs to be initialised first:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">decomp_2d_init</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="n">p_row</span><span class="p">,</span> <span class="n">p_col</span><span class="p">)</span>
</pre></div>
</div>
<p>where <span class="math notranslate nohighlight">\(nx\times ny\times nz\)</span> is the 3D domain size and <span class="math notranslate nohighlight">\(p\_row \times p\_col\)</span>
is the 2D processor grid.
Then one needs to initialise the FFT interface by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">decomp_2d_fft_init</span>
</pre></div>
</div>
<p>The initialisation routine handles planing for the underlying FFT engine (if supported)
and defines global data structures (such as temporary work spaces) for the computations.
By default, it assumes that physical-space data is distributed in X-pencil format <code class="docutils literal notranslate"><span class="pre">PHYSICAL_IN_X</span></code>.
The corresponding spectral-space data is stored in transposed Z-pencil format after the FFT.
To give applications more flexibility, the library also supports the opposite direction Z-pensil,
passing the optional parameter <code class="docutils literal notranslate"><span class="pre">PHYSICAL_IN_Z</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">decomp_2d_fft_init</span><span class="p">(</span><span class="n">PHYSICAL_IN_Z</span><span class="p">)</span>
</pre></div>
</div>
<p>Physical-space data in Y-pencil is not supported since it requires additional expensive transpositions
which does not make economical sense.
There is a third and the most flexible form of the initialisation routine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">decomp_2d_fft_init</span><span class="p">(</span><span class="n">pencil</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">pencil=PHYSICAL_IN_X</span></code> or <code class="docutils literal notranslate"><span class="pre">PHYSICAL_IN_Z</span></code> and <code class="docutils literal notranslate"><span class="pre">n1,</span> <span class="pre">n2,</span> <span class="pre">n3</span></code> is an arbitrary problem size
different from <span class="math notranslate nohighlight">\(nx\times ny\times nz\)</span>.
The result of the <code class="docutils literal notranslate"><span class="pre">decomp_2d_fft_init</span></code> operation is to create two new objects of type <code class="docutils literal notranslate"><span class="pre">DECOMP_INFO</span></code>:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ph</span></code> - structure with default size <span class="math notranslate nohighlight">\(nx\times ny\times nz\)</span> or size <span class="math notranslate nohighlight">\(n1\times n2\times n3\)</span>
in case of arbitrary defined problem</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sh</span></code> - structure for the <code class="docutils literal notranslate"><span class="pre">r2c/c2r</span></code> transform which with dimensions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PHYSICAL_IN_X</span></code> - <span class="math notranslate nohighlight">\(nx/2+1\times ny\times nz\)</span> (default) or <span class="math notranslate nohighlight">\(n1/2+1\times n2\times n3\)</span> (customized)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PHYSICAL_IN_Z</span></code> - <span class="math notranslate nohighlight">\(nx\times ny\times nz/2+1\)</span> (default) or <span class="math notranslate nohighlight">\(n1\times n2\times n3/2+1\)</span> (customized)</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="complex-to-complex-transforms">
<h2>Complex-to-complex Transforms<a class="headerlink" href="#complex-to-complex-transforms" title="Permalink to this headline">¶</a></h2>
<p>The library supports three-dimensional FFTs whose data is distributed as 2D pencils and stored in ordinary ijk-ordered 3D arrays across processors.
For complex-to-complex (c2c) FFTs, the user interface is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">decomp_2d_fft_3d</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">direction</span></code> can be either <code class="docutils literal notranslate"><span class="pre">DECOMP_2D_FFT_FORWARD</span> <span class="pre">==</span> <span class="pre">-1</span></code> for forward transforms, or <code class="docutils literal notranslate"><span class="pre">DECOMP_2D_FFT_BACKWARD</span> <span class="pre">==</span> <span class="pre">1</span></code> for backward transforms.
The input array <code class="docutils literal notranslate"><span class="pre">input</span></code> and <code class="docutils literal notranslate"><span class="pre">output</span></code> array out are both complex and
have to be either a X-pencil/Z-pencil combination or vice versa, depending on the direction of FFT and
how the FFT interface is initialised (<code class="docutils literal notranslate"><span class="pre">PHYSICAL_IN_X</span></code>, the default, or <code class="docutils literal notranslate"><span class="pre">PHYSICAL_IN_Z</span></code> the optional).</p>
</div>
<div class="section" id="real-to-complex-complex-to-real-transforms">
<h2>Real-to-complex &amp; Complex-to-Real Transforms<a class="headerlink" href="#real-to-complex-complex-to-real-transforms" title="Permalink to this headline">¶</a></h2>
<p>The interface for the the real-to-complex and complex-to-real transform is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">decomp_2d_fft_3d</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">input</span></code> data are real type a forward transform is assumed obtaining a complex <code class="docutils literal notranslate"><span class="pre">output</span></code>.
Similarly a backward FFT is computed if <code class="docutils literal notranslate"><span class="pre">input</span></code> is a complex array and <code class="docutils literal notranslate"><span class="pre">output</span></code> a real array.
When real input is involved, the corresponding complex output satisfies so-called <em>Hermitian redundancy</em> -
i.e. some output values are complex conjugates of others.
Taking advantage of this, FFT algorithms can normally compute r2c and c2r transforms twice as fast as c2c transforms
while only using about half of the memory.
Unfortunately, the price to pay is that application’s data structures have to become slightly more complex.
For a 3D real input data set of size <span class="math notranslate nohighlight">\(nx\times ny\times nz\)</span> in a X-pencil deposition,
the complex output can be held in an array of size <span class="math notranslate nohighlight">\(nx/2+1\times ny\times nz\)</span>, with the first dimension being cut roughly in half.
This change in size is reflected in the dimension assigned to the <code class="docutils literal notranslate"><span class="pre">sp</span></code> structure previously described
The size of the <code class="docutils literal notranslate"><span class="pre">sp</span></code> can also be recovered using the following routine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">decomp_2d_fft_get_size</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
<p>Here all three arguments are 1D array of three elements, returning to the caller the starting index,
ending index and size of the sub-domain held by the current processor -
information very similar to the <code class="docutils literal notranslate"><span class="pre">start/end/size</span></code> variables defined in the main decomposition library.</p>
<p>Please note that the complex output arrays obtained from X-pencil and Z-pencil input do not contain identical information.
However, if <em>Hermitian redundancy</em> is taken into account, no physical information is lost and the real input can be fully recovered
through the corresponding inverse FFT from either complex array.</p>
<p>Please also note that 2DECOMP&amp;FFT does not scale the transforms. So a forward transform followed by a backward transform
will not recover the input unless applications normalise the result by the size of the transforms.</p>
</div>
<div class="section" id="deallocation-of-the-fft-module">
<h2>Deallocation of the FFT module<a class="headerlink" href="#deallocation-of-the-fft-module" title="Permalink to this headline">¶</a></h2>
<p>Finally, to release the memory used by the FFT interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">decomp_2d_fft_finalize</span>
</pre></div>
</div>
<p>It is possible to re-initialise the FFT interface in the same application at the later stage after it has been finalised, if this becomes necessary.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">2decomp_doc</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="domaindecomposition.html">Domain Decomposition Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="fft.html">Fast Fourier Transforms</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api_domain.html">2D Pencil Decomposition API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">API for Three-dimensional FFTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_halo.html">Halo-cell Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_io.html">Parallel I/O</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="api.html">API</a><ul>
      <li>Previous: <a href="api_domain.html" title="previous chapter">2D Pencil Decomposition API</a></li>
      <li>Next: <a href="api_halo.html" title="next chapter">Halo-cell Support</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Sylvain.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/pages/api_fft.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>